{% extends "base.html" %}

{% block title %}Experiment : {{ experiment_id }}{% endblock %}

{% block header %}Reinforcement Learning Training Site{% endblock %}

{% block content %}
<h1>Experiment : {{ experiment_id }}</h1>

<h3>Training Table</h3>
<div class="scroll-container">
    <table class="clean-table">
        <thead>
            <tr>
                <th>Training Step ID</th>
                <th>Experiment ID</th>
                <th>Episode</th>
                <th>Epsilon</th>
                <th>Reward</th>
                <th>Replay</th>
                <th>Model ID</th>
            </tr>
        </thead>
        <tbody>
            {% for train in training_runs %}
            <tr>
                <td>{{ train[0] }}</td>
                <td>{{ train[1] }}</td>
                <td>{{ train[2] }}</td>
                <td>{{ train[3] }}</td>
                <td>{{ train[4] }}</td>
                {% if train[5] == -1 %}
                    <td>{{ train[5] }}</td>
                {% else %}
                    <td>
                        <!-- <form method="POST" action="/replay_{{ train[5] }}">
                            <button type="submit">View</button>
                        </form> -->
                        <button onclick="sendReplay({{ train[5] }})">View Replay</button>
                    </td>
                {% endif %}
                <td>{{ train[6] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<h3>Evaluation Table</h3>
<div class="scroll-container">
    <table class="clean-table">
        <thead>
            <tr>
                <th>Evaluation Step ID</th>
                <th>Experiment ID</th>
                <th>Episode</th>
                <th>Reward</th>
                <th>Replay</th>
                <th>Model ID</th>
            </tr>
        </thead>
        <tbody>
            {% for eval in evaluation_table %}
            <tr>
                <td>{{ eval[0] }}</td>
                <td>{{ eval[1] }}</td>
                <td>{{ eval[2] }}</td>
                <td>{{ eval[3] }}</td>
                <td>{{ eval[4] }}</td>
                <td>{{ eval[5] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
function sendReplay(id) {
    fetch(`/replay_${id}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            // Include this if your server expects CSRF token
            // 'X-CSRFToken': getCSRFToken() 
        },
        body: JSON.stringify({})  // or include actual data if needed
    }).then(response => {
        if (!response.ok) {
            console.error("Request failed:", response.status);
        }
    }).catch(err => {
        console.error("Fetch error:", err);
    });
}
</script>

{% endblock %}
